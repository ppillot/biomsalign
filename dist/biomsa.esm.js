var e=function(){return(e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function t(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e}function r(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}var n,i=function(){function e(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),!0===t&&this.setAll()}return e.prototype.get=function(e){return 0!=(this._words[e>>>5]&1<<e)},e.prototype.set=function(e){this._words[e>>>5]|=1<<e},e.prototype.clear=function(e){this._words[e>>>5]&=~(1<<e)},e.prototype.flip=function(e){this._words[e>>>5]^=1<<e},e.prototype._assignRange=function(e,t,r){if(!(t<e)){for(var n=this._words,i=!0===r?4294967295:0,o=e>>>5,s=t>>>5,a=o;a<s;++a)n[a]=i;var u=o<<5,c=s<<5;if(!0===r)if(t-e<32)for(var h=e,f=t+1;h<f;++h)n[h>>>5]|=1<<h;else{for(h=e,f=u;h<f;++h)n[h>>>5]|=1<<h;for(h=c,f=t+1;h<f;++h)n[h>>>5]|=1<<h}else if(t-e<32)for(h=e,f=t+1;h<f;++h)n[h>>>5]&=~(1<<h);else{for(h=e,f=u;h<f;++h)n[h>>>5]&=~(1<<h);for(h=c,f=t+1;h<f;++h)n[h>>>5]&=~(1<<h)}return this}},e.prototype.setRange=function(e,t){return this._assignRange(e,t,!0)},e.prototype.clearRange=function(e,t){return this._assignRange(e,t,!1)},e.prototype.setBits=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._words,n=e.length,i=0;i<n;++i){var o=e[i];r[o>>>5]|=1<<o}return this},e.prototype.clearBits=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._words,n=e.length,i=0;i<n;++i){var o=e[i];r[o>>>5]&=~(1<<o)}return this},e.prototype.setAll=function(){return this._assignRange(0,this.length-1,!0)},e.prototype.clearAll=function(){return this._assignRange(0,this.length-1,!1)},e.prototype.flipAll=function(){for(var e=this._words.length,t=this._words,r=32-this.length%32,n=0;n<e-1;++n)t[n]=~t[n];return t[e-1]=~(t[e-1]<<r)>>>r,this},e.prototype._isRangeValue=function(e,t,r){if(!(t<e)){for(var n=this._words,i=!0===r?4294967295:0,o=e>>>5,s=t>>>5,a=o;a<s;++a)if(n[a]!==i)return!1;if(t-e<32){for(var u=e,c=t+1;u<c;++u)if(!!(n[u>>>5]&1<<u)!==r)return!1}else{var h=s<<5;for(u=e,c=o<<5<<5;u<c;++u)if(!!(n[u>>>5]&1<<u)!==r)return!1;for(u=h,c=t+1;u<c;++u)if(!!(n[u>>>5]&1<<u)!==r)return!1}return!0}},e.prototype.isRangeSet=function(e,t){return this._isRangeValue(e,t,!0)},e.prototype.isRangeClear=function(e,t){return this._isRangeValue(e,t,!1)},e.prototype.isAllSet=function(){return this._isRangeValue(0,this.length-1,!0)},e.prototype.isAllClear=function(){return this._isRangeValue(0,this.length-1,!1)},e.prototype.isSet=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._words,n=e.length,i=0;i<n;++i){var o=e[i];if(0==(r[o>>>5]&1<<o))return!1}return!0},e.prototype.isClear=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._words,n=e.length,i=0;i<n;++i){var o=e[i];if(0!=(r[o>>>5]&1<<o))return!1}return!0},e.prototype.isEqualTo=function(e){for(var t=this._words,r=e._words,n=Math.min(t.length,r.length),i=0;i<n;++i)if(t[i]!==r[i])return!1;return!0},e.prototype.getSize=function(){for(var e=this._words.length,t=this._words,n=0,i=0;i<e;++i)n+=r(t[i]);return n},e.prototype.difference=function(e){for(var t=this._words,r=e._words,n=Math.min(t.length,r.length),i=0;i<n;++i)t[i]=t[i]&~r[i];for(i=t.length;i<n;++i)t[i]=0;return this},e.prototype.union=function(e){for(var t=this._words,r=e._words,n=Math.min(t.length,r.length),i=0;i<n;++i)t[i]|=r[i];for(i=t.length;i<n;++i)t[i]=0;return this},e.prototype.intersection=function(e){for(var t=this._words,r=e._words,n=Math.min(t.length,r.length),i=0;i<n;++i)t[i]&=r[i];for(i=t.length;i<n;++i)t[i]=0;return this},e.prototype.intersects=function(e){for(var t=this._words,r=e._words,n=Math.min(t.length,r.length),i=0;i<n;++i)if(0!=(t[i]&r[i]))return!0;return!1},e.prototype.getIntersectionSize=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),o=0,s=0;s<i;++s)o+=r(t[s]&n[s]);return o},e.prototype.makeIntersection=function(t){var r=this._words,n=t._words,i=Math.min(r.length,n.length),o=new Uint32Array(i),s=Object.create(e.prototype);s._words=o,s.length=Math.min(this.length,t.length);for(var a=0;a<i;++a)o[a]=r[a]&n[a];return s},e.prototype.forEach=function(e){for(var t=this._words.length,n=this._words,i=0,o=0;o<t;++o)for(var s=n[o];0!==s;){var a=s&-s;e((o<<5)+r(a-1),i),s^=a,++i}},e.prototype.toArray=function(){for(var e=this._words,t=new Array(this.getSize()),n=this._words.length,i=0,o=0;o<n;++o)for(var s=e[o];0!==s;){var a=s&-s;t[i++]=(o<<5)+r(a-1),s^=a}return t},e.prototype.toString=function(){return"{"+this.toArray().join(",")+"}"},e.prototype.toSeleString=function(){var e=this.toArray().join(",");return e?"@"+e:"NONE"},e.prototype.clone=function(){var t=Object.create(e.prototype);return t.length=this.length,t._words=new Uint32Array(this._words),t},e}();!function(e){e[e.PROTEIN=0]="PROTEIN",e[e.NUCLEIC=1]="NUCLEIC",e[e.UNSET=2]="UNSET"}(n||(n={}));var o={matrix:[[58,23,-12,-7,-44,10,-23,-14,-14,-27,-17,-8,1,-9,-22,23,15,5,-74,-45,0],[23,224,-67,-63,-50,-30,-29,1,-56,-41,-6,-33,-44,-53,-43,15,2,18,-93,-6,0],[-12,-67,111,59,-104,-4,4,-84,6,-88,-65,48,-13,18,-29,5,-7,-63,-105,-73,0],[-7,-63,59,85,-83,-17,-1,-63,25,-60,-47,15,-12,40,-8,1,-7,-47,-108,-51,0],[-44,-50,-104,-83,144,-93,4,12,-74,36,30,-64,-67,-56,-65,-43,-41,-3,63,104,0],[10,-30,-4,-17,-93,140,-32,-95,-27,-91,-75,4,-36,-29,-32,5,-26,-68,-80,-79,0],[-23,-29,4,-1,4,-32,137,-50,6,-37,-42,21,-23,27,19,-4,-12,-44,-13,48,0],[-14,1,-84,-63,12,-95,-50,86,-53,53,47,-62,-60,-47,-55,-43,-8,69,-27,-24,0],[-14,-56,6,25,-74,-27,6,-53,75,-48,-30,13,-12,34,68,-3,-4,-44,-71,-49,0],[-27,-41,-88,-60,36,-91,-37,53,-48,88,62,-63,-48,-36,-48,-47,-25,36,-11,-4,0],[-17,-6,-65,-47,30,-75,-42,47,-30,62,103,-45,-54,-21,-31,-35,-9,31,-46,-20,0],[-8,-33,48,15,-64,4,21,-62,13,-63,-45,89,-25,12,2,22,10,-51,-79,-29,0],[1,-44,-13,-12,-67,-36,-23,-60,-12,-48,-54,-25,160,-6,-20,5,-12,-42,-76,-83,0],[-9,-53,18,40,-56,-29,27,-47,34,-36,-21,12,-6,75,34,1,-4,-37,-92,-48,0],[-22,-43,-29,-8,-65,-32,19,-55,68,-48,-31,2,-20,34,113,-10,-14,-49,-58,-39,0],[23,15,5,1,-43,5,-4,-43,-3,-47,-35,22,5,1,-10,53,32,-28,-62,-31,0],[15,2,-7,-7,-41,-26,-12,-8,-4,-25,-9,10,-12,-4,-14,32,68,0,-87,-40,0],[5,18,-63,-47,-3,-68,-44,69,-44,36,31,-51,-42,-37,-49,-28,0,74,-61,-32,0],[-74,-93,-105,-108,63,-80,-13,-27,-71,-11,-46,-79,-76,-92,-58,-62,-87,-61,289,81,0],[-45,-6,-73,-51,104,-79,48,-24,-49,-4,-20,-29,-83,-48,-39,-31,-40,-32,81,162,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],center:22,gapOP:-300},s={matrix:[[91,-114,-31,-123],[-114,100,-125,-31],[-31,-125,100,-114],[-123,-31,-114,91]],gapOP:-400,gapEP:-60,center:120};var a=/^[ACGTRNDEQHILKMFPSWYV]+$/,u=/^[ABCDGHKMNRSTUVWY]+$/i,c=/^[ABCGTRNDEQHIJLKMFPSWYUVXZ]+$/i,h=/[^ACGU]/i,f=/[^ACGT]/i;function p(e){if(!h.test(e)||!f.test(e))return n.NUCLEIC;var t=u.test(e),r=a.test(e);if(r&&!t)return n.PROTEIN;if(r&&t)return function(e){for(var t=100,r=0,i=Math.min(e.length,t),o=0;o<i;o++)switch(e[o]){case"A":case"T":case"U":case"G":case"C":case"N":r++}return r/i>Math.SQRT1_2?n.NUCLEIC:n.PROTEIN}(e);if(c.test(e))return n.PROTEIN;throw new Error("Unrecognized sequence type: "+e)}var l=new Uint8Array(96);l.fill(255),l[65]=0,l[67]=1,l[68]=2,l[69]=3,l[70]=4,l[71]=5,l[72]=6,l[73]=7,l[75]=8,l[76]=9,l[77]=10,l[78]=11,l[80]=12,l[81]=13,l[82]=14,l[83]=15,l[84]=16,l[86]=17,l[87]=18,l[89]=19,l[95]=20;var g=new Uint8Array(96);function d(e,t){var r=Math.floor(100*Math.random());switch(t){case n.NUCLEIC:switch(e){case"M":return[0,1][r%2];case"R":return[0,2][r%2];case"W":return[0,3][r%2];case"S":return[1,2][r%2];case"Y":return[1,3][r%2];case"K":return[2,3][r%2];case"V":return[0,1,2][r%3];case"H":return[0,1,3][r%3];case"D":return[0,2,3][r%3];case"B":return[1,2,3][r%3];case"N":default:return r%4}case n.PROTEIN:default:switch(e){case"B":return[2,11][r%2];case"Z":return[3,13][r%2];case"J":return[7,9][r%2];case"U":case"X":default:return r%20}}}function m(e){return e.map((function(e){return S[e]}))}g.fill(255),g[65]=0,g[67]=1,g[71]=2,g[84]=3,g[85]=3;var S=[0,1,2,2,3,0,4,5,4,5,5,2,0,2,4,0,0,5,3,3];function _(e,t){var r=null!=t?t:p(e),i=function(e,t){for(var r=new Uint8Array(e.length),i=t===n.PROTEIN?l:g,o=0,s=0,a=e.length;s<a;s++)255===(o=i[e.charCodeAt(s)])&&(o=d(e[s],t)),r[s]=o;return r}(e,r);return{rawSeq:e,encodedSeq:i,compressedSeq:r===n.PROTEIN?m(i):i,type:r}}function y(e,t,r){for(var n=[],i=r.gapchar,o=0,s=0;s<t.length;s++){var a=t[s];a<0?n.push(i.repeat(-a)):(n.push(e.substr(o,a)),o+=a)}return n.join("")}function v(e,t){var r=[0],n=0,i=t.slice();function o(e){(e^r[r.length-1])>=0?r[r.length-1]+=e:r.push(e)}for(var s=0;s<e.length;s++){var a=e[s];if(a<0)o(a);else for(;a>0&&n<i.length;){var u=i[n];u<0?a<-u?(i[n]+=a,o(-a),a=0):(o(u),a+=u,n++):a<u?(i[n]-=a,o(a),a=0):(o(u),a-=u,n++)}}return r}function w(e,t){for(var r=[],n=0,i=0,o=e[0],s=t[0];n<e.length||i<t.length;)o!==s?Math.sign(o)!==Math.sign(s)?o<0||void 0===s?(r.push(o),o=e[++n]):(r.push(s),s=t[++i]):o>0?o>s?(r.push(s),o-=s,s=t[++i]):(r.push(o),s-=o,o=e[++n]):(r.push(Math.min(o,s)),o=e[++n],s=t[++i]):(r.push(s),o=e[++n],s=t[++i]);return r}function b(e,t){for(var r=[],n=0,i=0,o=t[0],s=e[0],a=0;n<t.length||i<e.length;)if(a=r[r.length-1],o!==s){if(Math.sign(o)===Math.sign(s)){if(o>0){if(s>o)return;a>0?r[r.length-1]=a+s:r.push(s),o-=s,s=e[++i];continue}if(o>s){a>0?r[r.length-1]=a-o:r.push(Math.abs(o)),s-=o=t[++n];continue}return}if(!(s<0))return;a<0?r[r.length-1]=a+s:r.push(s),s=e[++i]}else a>0?r[r.length-1]=a+Math.abs(o):r.push(Math.abs(o)),o=t[++n],s=e[++i];return r}function O(e,r){if(Math.sign(e[e.length-1])===Math.sign(r[0])){var n=t([],e);return n[n.length-1]+=r[0],n.push.apply(n,r.slice(1)),n}return t(t([],e),r)}function A(e,t){void 0===t&&(t=0);for(var r=[],n=0,i=0,o=0;o<e.length;o++)((i=e[o])^n)>=0?n+=i:(r.push(n),n=i);return r.push(n),0===r[0]&&r.shift(),1&t||r.reverse(),r}function q(e){for(var t=0,r=0,n=0;n<e.length;n++)t+=(r=e[n])<0?-r:r;return t}function C(e){for(var t=[],r=0,n=0,i=0;i<e.length;i++)if((n=e[i])<0)for(var o=0;o<-n;o++)t.push(-1);else for(o=0;o<n;o++)t.push(r),r++;return t}function E(e,t,r,n){void 0===n&&(n=0);var i=e.rawSeq.length,o=t.rawSeq.length,s=0,a=[],u=[],c=0,h=0,f=0,p=0,l=new Uint8Array(Math.ceil((i+1)*o/2)),g=e.encodedSeq,d=t.encodedSeq,m=0,S=0,_=0,y=r.scoringMatrix[0],v=r.gapOP,w=1&n?0:-v/2,b=2&n?0:-v/2;a[0]=0,u[0]=-1/0;for(var O=1;O<=o;O++)a[O]=v+w,u[O]=-1/0;for(var q=1;q<=i;q++){c=w,h=-1/0,y=r.scoringMatrix[g[q-1]];for(O=1;O<=o;O++)_=0,m=a[O]+v,O===o&&(m+=b),m>=u[O]?u[O]=m:_+=1,S=c+v,q===i&&(S+=b),S>=h?h=S:_+=2,s=a[O-1]+y[d[O-1]],a[O-1]=c,s>=h?s>=u[O]?c=s:(c=u[O],_+=4):h>=u[O]?(c=h,_+=8):(c=u[O],_+=4),p=(f=q*o+O)%2,l[f>>>=1]+=p?_:_<<4;a[o]=c}var C=Math.max(s,h,u[u.length-1]),E=P(l,i,o,_),G=E[0],I=E[1];return{estrings:[A(G),A(I)],score:C}}function P(e,t,r,n){for(var i=t,o=r,s=t*r+r,a=1,u=[],c=[],h=(12&n)>>2,f=0;i>0&&o>0;)a=(s=i*r+o)%2,f=e[s>>>1],f=a?15&f:f>>>4,0===h?0===(f>>=2)&&(i--,o--,u.push(1),c.push(1)):2===h?(u.push(-1),c.push(1),f&=2,o--):(u.push(1),c.push(-1),f&=1,i--),h=f;return i>0?(u.push(i),c.push(-i)):o>0&&(u.push(-o),c.push(o)),[u,c]}var G,I=function(){function e(e,t,r,n){void 0===n&&(n=0),this.nbSeq=0,this.length=0,this.weight=0,this.length=e,this.m_bAllGaps=new i(e),this.m_uSortOrder=new Uint8Array(t*e),this.m_fcCounts=new Uint8Array(t*e),this.m_wCounts=new Float32Array(t*e),this.m_AAScores=new Float32Array(t*e),this.m_uResidueGroup=new Uint8Array(e),this.m_fOcc=new Float32Array(e),this.m_fcStartOcc=new Float32Array(e),this.m_fcEndOcc=new Float32Array(e),this.m_ScoreGapOpen=new Float32Array(e),this.m_ScoreGapClose=new Float32Array(e),this.nbSeq=r,this.alphaSize=t,this.weight=n}return e.prototype.getProxy=function(e){return void 0===e&&(e=0),new M(this,e)},e}(),M=function(){function e(e,t){void 0===t&&(t=0),this.idx=0,this.alphaSize=4,this.offset=0,this.prof=e,this.idx=t,this.alphaSize=e.alphaSize,this.offset=this.idx*this.alphaSize}return e.prototype.setProxy=function(e){this.idx=e,this.offset=e*this.alphaSize},Object.defineProperty(e.prototype,"m_bAllGaps",{get:function(){return this.prof.m_bAllGaps.get(this.idx)},set:function(e){e?this.prof.m_bAllGaps.set(this.idx):this.prof.m_bAllGaps.clear(this.idx)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_uSortOrder",{get:function(){return this.prof.m_uSortOrder.subarray(this.offset,this.offset+this.alphaSize)},set:function(e){this.prof.m_uSortOrder.set(e,this.offset)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_uResidueGroup",{get:function(){return this.prof.m_uResidueGroup[this.idx]},set:function(e){this.prof.m_uResidueGroup[this.idx]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_fcCounts",{get:function(){return this.prof.m_fcCounts.subarray(this.offset,this.offset+this.alphaSize)},set:function(e){this.prof.m_fcCounts.set(e,this.offset)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_wCounts",{get:function(){return this.prof.m_wCounts.subarray(this.offset,this.offset+this.alphaSize)},set:function(e){this.prof.m_wCounts.set(e,this.offset)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_AAScores",{get:function(){return this.prof.m_AAScores.subarray(this.offset,this.offset+this.alphaSize)},set:function(e){this.prof.m_AAScores.set(e,this.offset)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_fOcc",{get:function(){return this.prof.m_fOcc[this.idx]},set:function(e){this.prof.m_fOcc[this.idx]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_fcStartOcc",{get:function(){return this.prof.m_fcStartOcc[this.idx]},set:function(e){this.prof.m_fcStartOcc[this.idx]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_fcEndOcc",{get:function(){return this.prof.m_fcEndOcc[this.idx]},set:function(e){this.prof.m_fcEndOcc[this.idx]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_ScoreGapOpen",{get:function(){return this.prof.m_ScoreGapOpen[this.idx]},set:function(e){this.prof.m_ScoreGapOpen[this.idx]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m_ScoreGapClose",{get:function(){return this.prof.m_ScoreGapClose[this.idx]},set:function(e){this.prof.m_ScoreGapClose[this.idx]=e},enumerable:!1,configurable:!0}),e}();function x(e,t,r,n){void 0===n&&(n=0);for(var i=e.encodedSeq,o=i.length,s=new I(o,r.abSize,1,t),a=t,u=r.gapOP,c=s.getProxy(),h=0,f=0;f<o;f++){c.setProxy(f),h=i[f],c.m_fcCounts[h]=1,c.m_wCounts[h]=a,c.m_uSortOrder[c.m_uResidueGroup]=h,c.m_uResidueGroup=1,c.m_fOcc=a,c.m_ScoreGapOpen=u/2*a,c.m_ScoreGapClose=u/2*a;for(var p=0;p<r.abSize;p++)c.m_AAScores[p]=a*r.scoringMatrix[p][h]}return 1&n||(s.m_ScoreGapOpen[0]/=2,s.m_ScoreGapOpen[o-1]/=2),2&n||(s.m_ScoreGapClose[0]/=2,s.m_ScoreGapClose[o-1]/=2),s}function R(e,t,r,n,i,o){void 0===o&&(o=0);for(var s=q(r),a=e.nbSeq+t.nbSeq,u=e.weight+t.weight,c=new I(s,i.abSize,a,u),h=i.gapOP,f=c.getProxy(),p=e.getProxy(),l=t.getProxy(),g=C(r),d=C(n),m=0,S=0,_=!1,y=!1,v=!1,w=!1,b=0,O=0;O<s;O++){if(f.setProxy(O),m=g[O],p.setProxy(m),-1===m?(_=!0,y=O===s-1||g[O+1]>0):(_=!1,y=!1),S=d[O],l.setProxy(S),-1===S?(v=!0,w=O==s-1||d[O+1]>0):(v=!1,w=!1),b=0,-1!==m&&-1!==S){f.m_fcStartOcc=p.m_fcStartOcc+l.m_fcStartOcc,f.m_fcEndOcc=p.m_fcEndOcc+l.m_fcEndOcc,f.m_fOcc=p.m_fOcc+l.m_fOcc,f.m_fcCounts.set(p.m_fcCounts),f.m_wCounts.set(p.m_wCounts);for(var A=0;A<t.alphaSize;A++){var E=t.m_fcCounts[A];E&&(f.m_fcCounts[A]+=E,f.m_wCounts[A]+=t.m_wCounts[A]),f.m_fcCounts[A]&&(f.m_uSortOrder[b]=A,b++),f.m_AAScores[A]=p.m_AAScores[A]+l.m_AAScores[A]}f.m_uResidueGroup=b}-1==m&&(f.m_fcStartOcc=l.m_fcStartOcc+(_?e.weight:0),f.m_fcEndOcc=l.m_fcEndOcc+(y?e.weight:0),f.m_fOcc=l.m_fOcc,f.m_fcCounts.set(l.m_fcCounts),f.m_wCounts.set(l.m_wCounts),f.m_uSortOrder.set(l.m_uSortOrder),f.m_AAScores.set(l.m_AAScores),f.m_uResidueGroup=l.m_uResidueGroup),-1==S&&(f.m_fcStartOcc=p.m_fcStartOcc+(v?t.weight:0),f.m_fcEndOcc=p.m_fcEndOcc+(w?t.weight:0),f.m_fOcc=p.m_fOcc,f.m_fcCounts.set(p.m_fcCounts),f.m_wCounts.set(p.m_wCounts),f.m_uSortOrder.set(p.m_uSortOrder),f.m_AAScores.set(p.m_AAScores),f.m_uResidueGroup=p.m_uResidueGroup),f.m_ScoreGapOpen=h/2*(1-f.m_fcStartOcc)*u,f.m_ScoreGapClose=h/2*(1-f.m_fcEndOcc)*u}return 1&o||(c.m_ScoreGapOpen[0]/=2,c.m_ScoreGapOpen[s-1]/=2),2&o||(c.m_ScoreGapClose[0]/=2,c.m_ScoreGapClose[s-1]/=2),c}function z(e){return"seq"in e}function U(e,t){for(var r=1/0,n=0,i=0,o=e.length,s=0;s<o;s++)for(var a=s+1;a<o;a++)e[s][a]<r&&(r=e[s][a],n=s,i=a);return[{profile:null,childA:t[n],childB:t[i],distance:r,estring:[],msa:[],numSeq:[],type:G.NODE,depth:0,id:"",tabWeight:[],parent:-1,weight:0},n,i]}function T(e,t,r,n){for(var i=t>r?[t,r]:[r,t],o=i[0],s=i[1],a=[],u=e.length,c=0;c<u;c++)if(c!=t&&c!=r){var h=.1*(e[c][t]+e[c][r])/2+.9*Math.min(e[c][t],e[c][r]);e[c].push(h),a.push(h),e[c].splice(o,1),e[c].splice(s,1)}return a.push(0),e.push(a),e.splice(o,1),e.splice(s,1),n.splice(o,1),n.splice(s,1),e}function N(e,r){var o,s,a,u=function(e,n){var i=c[e.childA],o=c[e.childB],s={};if(z(i)||0!==i.msa.length||u(i,n),z(o)||0!==o.msa.length||u(o,n),z(i))if(z(o)){var a=E(i.seq,o.seq,r);s.score=a.score,e.numSeq=[i.numSeq[0],o.numSeq[0]],e.estring=a.estrings,e.profile=R(i.profile,o.profile,a.estrings[0],a.estrings[1],r)}else{o.tabWeight=n.filter((function(e,t){return o.numSeq.includes(t)}));var h=function(e,t,r,n){void 0===n&&(n=0);var i,o,s=t.seq,a=s.rawSeq.length,u=e.profile.length,c=0,h=[],f=[],p=new Uint8Array(Math.ceil((u+1)*(a+1)/2)),l=0,g=0,d=0,m=0,S=0,_=0,y=0,v=0,w=0,b=0,O=new Float32Array(r.abSize),q=r.gapOP,C=q/2,E=q/2,G=1&n?0:-q/4,I=2&n?0:-q/4,M=s.encodedSeq,x=e.profile;h[0]=0,f[0]=-1/0;for(var R=1;R<=a;R++)h[R]=C+E+G,f[R]=-1/0;for(var z=1;z<=u;z++){for(w=x.m_ScoreGapOpen[z-1],b=x.m_ScoreGapClose[z-1],O=x.m_AAScores.subarray((z-1)*r.abSize,z*r.abSize),_=G,m=-1/0,f[0]=x.m_ScoreGapOpen[0],R=1;R<=a;R++)d=0,l=h[R]+w,R===a&&(l-=w/2),l>=f[R]?f[R]=l:d+=1,g=_+C,z===u&&(g+=I),g>=(S=m)?m=g:d+=2,y=f[R]+b,v=S+E,c=h[R-1]+O[M[R-1]],R===a&&(v+=I),h[R-1]=_,c>=v?c>=y?_=c:(_=y,d+=4):v>=y?(_=v,d+=8):(_=y,d+=4),o=(i=z*a+R)%2,p[i>>>=1]+=o?d:d<<4;h[a]=_}var U=Math.max(c,m,f[f.length-2]),T=P(p,u,a,d),N=T[0],D=T[1];return{estrings:[A(N),A(D)],score:U}}(o,i,r);s.score=h.score,e.numSeq=t([i.numSeq[0]],o.numSeq),e.estring=t([h.estrings[1]],o.estring.map((function(e){return v(h.estrings[0],e)}))),e.profile=R(i.profile,o.profile,h.estrings[1],h.estrings[0],r)}else if(!z(o)){o.tabWeight=n.filter((function(e,t){return o.numSeq.includes(t)})),i.tabWeight=n.filter((function(e,t){return i.numSeq.includes(t)}));var f=function(e,t,r,n){void 0===n&&(n=0);var i,o,s=e.profile.length,a=t.profile.length,u=new Uint8Array(Math.ceil((s+1)*(a+1)/2)),c=[],h=[],f=0,p=0,l=0,g=0,d=0,m=0,S=0,_=0,y=0,v=0,w=0,b=0,O=new Float32Array(r.abSize),q=new Uint8Array(r.abSize),C=0,E=0,G=0,I=0,M=0,x=0,R=1&n?1:2,z=t.profile,U=e.profile;for(c[0]=0,h[0]=-1/0,M=1;M<=a;M++)c[M]=z.m_ScoreGapOpen[0]+z.m_ScoreGapClose[M-1]/R,h[M]=-1/0;var T=U.m_ScoreGapOpen[0];for(I=1;I<=s;I++){for(O=U.m_AAScores.subarray(r.abSize*(I-1),r.abSize*I),w=U.m_ScoreGapOpen[I-1],_=T+(b=U.m_ScoreGapClose[I-1])/R,m=-1/0,h[0]=U.m_ScoreGapOpen[0],M=1;M<=a;M++){for(d=0,p=c[M]+w,M!==a||2&n||(p-=w/2),p>=h[M]?h[M]=p:d+=1,l=_+z.m_ScoreGapOpen[M-1],g=S=m,I!==s||2&n||(l-=z.m_ScoreGapOpen[M-1]/2),l>=g?m=l:d+=2,f=c[M-1],G=z.m_uResidueGroup[M-1],x=0,E=(M-1)*r.abSize,q=z.m_uSortOrder.subarray(E,E+G);x<G;)C=q[x],f+=z.m_wCounts[E+C]*O[C],x++;y=h[M]+b,v=S+z.m_ScoreGapClose[M-1],1!==M||2&n||(y-=b/2),M!==a||2&n||(y-=b/2,v-=z.m_ScoreGapClose[a-1]/2),c[M-1]=_,f>=v?f>=y?_=f:(_=y,d+=4):v>=y?(_=v,d+=8):(_=y,d+=4),o=(i=I*a+M)%2,u[i>>>=1]+=o?d:d<<4}c[a]=_}var N=Math.max(f,m,h[M-1]),D=P(u,s,a,d),j=D[0],F=D[1];return{estrings:[A(j),A(F)],score:N}}(i,o,r);s.score=f.score,e.estring=t(t([],i.estring.map((function(e){return v(f.estrings[0],e)}))),o.estring.map((function(e){return v(f.estrings[1],e)}))),e.profile=R(i.profile,o.profile,f.estrings[0],f.estrings[1],r)}return e.numSeq=t(t([],i.numSeq),o.numSeq),s.score},c=function(e,t){for(var r,n,i,o,s=[],a=e.length,u=[],c=0;c<a;c++)s[c]={type:G.LEAF,seq:t[c],profile:null,childA:c,childB:c,distance:0,numSeq:[c],msa:[],id:c.toString(),weight:0,parent:-1,depth:0},u[c]=c;c=0;for(var h=a-1;c<h;c++){n=(r=U(e,u))[0],i=r[1],o=r[2];var f=s[n.childA],p=s[n.childB];n.id=f.id<p.id?"|"+f.id+","+p.id+"|":"|"+p.id+","+f.id+"|",n.depth=Math.max(f.depth,p.depth)+1,p.parent=f.parent=s.length,u.push(a+c),s.push(n),e=T(e,i,o,u)}return s[s.length-1].type=G.ROOT,s}(function(e){for(var t,r,o,s=e[0].type===n.PROTEIN,a=s?6:4,u=Math.pow(a,6),c=e.map((function(e){for(var t=new i(u),r=s?e.compressedSeq:e.encodedSeq,n=0,o=0;o<=5;o++)n+=r[o]*Math.pow(a,o);t.set(n);for(var c=Math.pow(a,5),h=(o=6,r.length);o<h;o++)n-=r[o-6],n/=6,n+=r[o]*c,t.set(n);return t})),h=e.length,f=e.map((function(){return[]})),p=0;p<h;p++){f[p][p]=0,t=c[p],r=e[p].compressedSeq.length;for(var l=p+1;l<h;l++)o=1-t.getIntersectionSize(c[l])/r,f[l][p]=f[p][l]=o}return f}(e),e),h=c[c.length-1],f=function(e){var t=[],r=0;!function t(n){var i=0,o=0;switch(n.type){case G.ROOT:n.weight=0,t(e[n.childA]),t(e[n.childB]);break;case G.NODE:i=e[n.parent].distance-n.distance,o=n.id.split(",").length,n.weight=e[n.parent].weight+i/o,t(e[n.childA]),t(e[n.childB]);break;case G.LEAF:i=e[n.parent].distance,n.weight=e[n.parent].weight+i,r+=n.weight}}(e[e.length-1]);for(var n=0;e[n].type==G.LEAF;)t[n]=e[n].weight/=r,n++;return t}(c);return function(e,t,r){for(var n=0,i=e[n];z(i)&&n<e.length;)i.profile=x(i.seq,i.weight,t,r),i=e[++n]}(c,r),u(h,f),o=h.estring.slice(),s=h.numSeq,a=s.slice(),s.forEach((function(e,t){return a[e]=t})),a.map((function(e){return o[e]}))}!function(e){e[e.LEAF=0]="LEAF",e[e.NODE=1]="NODE",e[e.ROOT=2]="ROOT"}(G||(G={}));var D=function(){function e(e){this.storeSize=e,this.store=new Array(e),this.head=0,this.tail=0}return Object.defineProperty(e.prototype,"size",{get:function(){return(this.tail-this.head+this.storeSize)%this.storeSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.head===this.tail},enumerable:!1,configurable:!0}),e.prototype.popHead=function(){if(this.isEmpty)return null;var e=this.store[this.head];return this.head++,this.head>=this.storeSize&&(this.head=0),e},e.prototype.popTail=function(){return this.isEmpty?null:(this.tail--,this.tail<0&&(this.tail=this.storeSize-1),this.store[this.tail])},e.prototype.pushHead=function(e){this.head--,this.head<0&&(this.head=this.storeSize-1),this.store[this.head]=e,this.head===this.tail&&(this.tail=(this.tail-1+this.storeSize)%this.storeSize)},e.prototype.pushTail=function(e){this.store[this.tail]=e,this.tail++,this.tail>=this.storeSize&&(this.tail=0),this.head===this.tail&&(this.head=(this.head-1+this.storeSize)%this.storeSize)},e.prototype.getHead=function(e){void 0===e&&(e=0);var t=0===e?this.head:(this.head+e+this.storeSize)%this.storeSize;return this.store[t]},e.prototype.getTail=function(e){void 0===e&&(e=0);var t=(this.tail-1-e+this.storeSize)%this.storeSize;return this.store[t]},e}();function j(e,t,r){for(var n=new Map,i=new D(r),o=0|t,s=new Uint16Array(e.encodedSeq.length-o+1),a=0,u=0,c=0;c<o;c++)a|=e.encodedSeq[o-c-1]<<2*c;s[u++]=a;c=o;for(var h=e.encodedSeq.length;c<h;c++)a=(a<<2)+e.encodedSeq[c],s[u++]=a;var f=r-o,p=e.rawSeq.length*(2/(r+1))*2|0,l={kmer:new Uint16Array(p),kmerPos:new Uint16Array(p),winPos:new Uint16Array(p),winPosEnd:new Uint16Array(p),count:0},g=NaN;for(c=0;c<s.length;c++){for(var d=s[c];!i.isEmpty&&s[i.getTail()]>=d;)i.popTail();if(i.pushTail(c),!(c<f)){for(;i.getHead()<=c-1-f;)i.popHead();var m=i.getHead();if(m===g)l.winPosEnd[l.count-1]=c+o;else{var S=s[m],_=l.count;if(l.count++,l.kmer[_]=S,l.kmerPos[_]=m,l.winPos[_]=c-f,l.winPosEnd[_]=c+o,g=m,n.has(S))n.get(S).push(_);else n.set(S,[_])}}}return[n,l,s]}function F(e,t,r,n,i){var o=null!=n?n:j(e,8,16);o[0];for(var s=o[1],a=o[2],u=null!=i?i:j(t,8,16),c=u[0],h=u[1],f=u[2],p=new Map,l=0;l<s.count;l++){var g=s.kmer[l];if(c.has(g))for(var d=c.get(g),m=e.rawSeq.substring(s.winPos[l],s.winPosEnd[l]),S=0;S<d.length;S++){var _=d[S],y=t.rawSeq.substring(h.winPos[_],h.winPosEnd[_]),v=Math.min(m.length,y.length);if(v==m.length){if(0!==y.indexOf(m))continue}else if(0!==m.indexOf(y))continue;var w=s.winPos[l]-h.winPos[_],b={diagId:w,begin:s.winPos[l],end:s.winPos[l]+v};if(p.has(w))p.get(w).push(b);else p.set(w,[b])}}var C=[];p.forEach((function(e){var t=e[0];C.push(t),e.forEach((function(e){e.begin<=t.end?t.end=e.end:(t=e,C.push(t))}))})),C.sort((function(e,t){var r=e.begin-t.begin;return 0===r?e.diagId-t.diagId:r}));var P=C[0],G=[P],I=[];for(l=1;l<C.length;l++){var M=C[l];if(!(M.begin<P.end))if(M.diagId!==P.diagId){for(R=(x=P.end)-P.diagId;e.encodedSeq[x]===t.encodedSeq[R]&&x<M.begin;)x++,R++;for(P.end=x,R=(x=M.begin)-M.diagId;e.encodedSeq[x]===t.encodedSeq[R]&&x>P.end;)x--,R--;M.begin=x+1,I.push({endDiagId:M.diagId,beginDiagId:P.diagId,begin:P.end,end:M.begin,size:M.begin-P.end}),G.push(M),P=M}else{for(var x,R=(x=P.end)-M.diagId,z=0;x<M.begin&&z<2;)R+=8,z=B(a[x+=8],f[R])<=2?0:z+1;for(x>P.end&&(P.end=x-2-8),R=(x=M.begin-8)-M.diagId,z=0;x>P.end&&z<2;)R-=8,z=B(a[x-=8],f[R])<=2?0:z+1;if(x<M.begin-16&&(M.begin=x+24+2),M.begin-P.end<=24){P.end=M.end;continue}I.push({beginDiagId:P.diagId,endDiagId:M.diagId,begin:P.end,end:M.begin,size:M.begin-P.end}),G.push(M),P=M}}var U=G[0],T=[],N=[];for(l=0;l<G.length;l++){U=G[l],T.push(U.end-U.begin),N.push(U.end-U.begin);var D=I[l];if(D){if(D.begin===D.end){T.push(-Math.abs(D.endDiagId-D.beginDiagId)),N.push(0);continue}if(D.begin-D.beginDiagId==D.end-D.endDiagId){N.push(-Math.abs(D.endDiagId-D.beginDiagId)),N.push(D.end-D.begin);continue}var F=E({rawSeq:e.rawSeq.substring(D.begin,D.end),type:e.type,compressedSeq:new Uint8Array(0),encodedSeq:e.encodedSeq.slice(D.begin,D.end)},{rawSeq:t.rawSeq.substring(D.begin-D.beginDiagId,D.end-D.endDiagId),type:t.type,compressedSeq:new Uint8Array(0),encodedSeq:t.encodedSeq.slice(D.begin-D.beginDiagId,D.end-D.endDiagId)},r,3);T.push.apply(T,F.estrings[0]),N.push.apply(N,F.estrings[1])}}L(T,e.encodedSeq.length),L(N,t.encodedSeq.length);var H=A(T,1),V=A(N,1),k=q(H),W=q(V);return k>W?V=O(V,[W-k]):k<W&&(H=O(H,[k-W])),[H,V]}function L(e,t){var r=t-function(e){for(var t=0,r=0,n=0;n<e.length;n++)(r=e[n])<0||(t+=r);return t}(e);r>0?e.push(r):r<0&&(e[e.length-1]+=r)}function B(e,t){var n=e^t;return r(n=1431655765&n|n>>1&1431655765)}var H={sequenceType:"auto",gapchar:"-",alignmentMethod:"auto",debug:!1},V=new(function(){function t(){this.sequences=[],this.typeSeq=n.UNSET,this.config=e({},H)}return t.prototype.addSequence=function(e){var t=this;if(Array.isArray(e))e.forEach((function(e){t.addSequence(e)}));else{if("string"!=typeof e)throw new TypeError("String type expected for sequences to add.");if(e=e.toUpperCase(),"auto"===this.config.sequenceType){var r=p(e);if(this.typeSeq===n.UNSET)this.typeSeq=r;else if(this.typeSeq!==r)throw new Error("All sequences must be of same type.")}this.sequences.push(_(e))}},t.prototype.reset=function(){this.sequences=[],this.typeSeq=n.UNSET,this.setDefaultConfiguration()},t.prototype.setDefaultConfiguration=function(){this.config=e({},H)},t.prototype.setUserConfiguration=function(e){var t;function r(e,t){return t.some((function(t){return t==e}))}e.method&&r(e.method,["complete","diag"])&&(this.config.alignmentMethod=e.method),e.type&&r(e.type,["amino","nucleic"])&&(this.config.sequenceType=e.type,this.typeSeq="amino"===e.type?n.PROTEIN:n.NUCLEIC),1===(null===(t=e.gapchar)||void 0===t?void 0:t.length)&&(this.config.gapchar=e.gapchar),void 0!==e.debug&&(this.config.debug=!!e.debug)},t.prototype.align=function(e,t){var r=this;return new Promise((function(i,a){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))return a("Array of sequences expected");if(e.length<2)return a("At least 2 sequences are required.");r.reset(),t&&r.setUserConfiguration(t),r.addSequence(e);var u,c=function(e,t){var r,i,a,u=e===n.PROTEIN?o:s,c=null!==(r=null==t?void 0:t.matrix)&&void 0!==r?r:u.matrix,h=(null==t?void 0:t.gapextend)?2*-t.gapextend:u.center;return{type:e,scoringMatrix:(a=h,c.map((function(e){return e.map((function(e){return e+a}))}))),gapOP:null!==(i=null==t?void 0:t.gapopen)&&void 0!==i?i:u.gapOP,abSize:e===n.PROTEIN?20:4}}(r.typeSeq,t),h=!1;(h="auto"===r.config.alignmentMethod?r.sequences.some((function(e){return e.rawSeq.length>1600})):"diag"===r.config.alignmentMethod,2==r.sequences.length)?u=h?F(r.sequences[0],r.sequences[1],c):E(r.sequences[0],r.sequences[1],c).estrings:u=h?function(e,t){for(var r=e.map((function(e){return j(e,8,16)})),n=[],i=[],o=[],s=0;s<r.length;s++)if(0!==s){var a=F(e[0],e[s],t,r[0],r[s]);i=0===i.length?a[0]:w(i,a[0]),o[s]=a[0],n[s]=a[1]}for(s=0;s<r.length;s++)if(0!==s){var u=b(i,o[s]);if(!u)throw console.error("An error occured while computing the center diff. for sequence #"+s,i,o[s]),console.dir(n),console.dir(o),new RangeError;n[s]=v(u,n[s])}else n[s]=i;return n}(r.sequences,c):N(r.sequences,c);return i(function(e,t,r){for(var n,i=null!==(n=null==r?void 0:r.gapchar)&&void 0!==n?n:"-",o=[],s=0;s<e.length;s++)o.push(y(e[s].rawSeq,t[s],{gapchar:i}));return o}(r.sequences,u,{gapchar:r.config.gapchar}))}))},t}());export{V as default};
//# sourceMappingURL=biomsa.esm.js.map
